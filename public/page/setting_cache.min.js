/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
let baseUrl=window.location.href;window.Lokasi={urlSimpan:`${baseUrl}/simpan`,urlTabel:`${baseUrl}/tabel`,urlHapus:`${baseUrl}/hapus`};const $tabelData=$("#tabel-data");TabelHelper.tabelDinamis($tabelData,Lokasi.urlTabel,[{extend:"excelHtml5",text:"Excel",exportOptions:{columns:":visible:not(:eq(6))"}}],[{targets:0,width:"5%"},{targets:[0,7],className:"dt-body-center"},{targets:[3,4],className:"dt-body-right"},{targets:"_all",className:"dt-head-center"},{targets:[3,4,5,6,7],orderable:!1},{targets:[0,3,4,5,6,7],searchable:!1}],[[0,"asc"]],{initComplete:function(){let api=this.api(),filterContainer=$("#tabel-data_filter"),extraFilters=$('<div class="ml-2 d-inline-block"></div>');api.columns([1,2]).every((function(){let column=this,headerText=$(column.header()).text().trim(),select=$('<select class="form-control form-control-sm d-inline-block w-auto mr-1"><option value="">Semua '+headerText+"</option></select>").appendTo(extraFilters).on("change",(function(){let val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val?"^"+val+"$":"",!0,!1).draw()}));column.data().unique().sort().each((function(d){let text=$("<div>").html(d).text().trim();select.append('<option value="'+text+'">'+text+"</option>")}))})),filterContainer.append(extraFilters)}}),$((function(){let $formId=$("#cache-form"),$btnSubmit=$("#cache-submit"),$btnLoading=$("#cache-loading");$btnLoading.hide();let formCek=FormHelper.cekFormData($formId);$formId.validate($.extend(FormHelper.validasiForm(),{ignore:[],rules:{cache_geoip:{required:!0},cache_device:{required:!0},statistik_user_list:{required:!0},statistik_user_login:{required:!0}},submitHandler:function(form){return $formId.find(":input").removeClass("is-invalid is-valid"),!!formCek.isChanged()&&FormHelper.submitForm(form,Lokasi.urlSimpan,$btnSubmit,$btnLoading,{formCek:formCek})}}))})),$(document).on("click",".btn-delete",(function(e){e.preventDefault();let filename=$(this).data("filename");Swal.fire({title:"Konfirmasi",text:"Hapus file: "+filename,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{result.isConfirmed&&$.ajax({url:Lokasi.urlHapus,type:"POST",data:{filename:filename},dataType:"json",success:function(res){res.success?Swal.fire("Berhasil",res.messages,"success").then((()=>{$tabelData.DataTable().ajax.reload(null,!1)})):Swal.fire("Error",res.messages,"error")},error:function(xhr){let msg=xhr.responseJSON?.messages||xhr.responseText||"Terjadi kesalahan...";Swal.fire("Error",msg,"error")}})}))}));