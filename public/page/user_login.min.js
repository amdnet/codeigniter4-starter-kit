/*!
 * CirebonWeb (https://cirebonweb.com)
 * Copyright (c) 2023 CirebonWeb
 * Licensed under MIT (https://opensource.org/licenses/MIT)
 */
let baseUrl=window.location.href;window.Lokasi={urlTabel:`${baseUrl}/tabel`,urlHapus:`${baseUrl}/hapus`,urlReset:`${baseUrl}/reset`};const $tabelData=$("#tabel-data"),$statContainer=$(".stat-container");function hapus(){let selected=$(".checkItem:checked"),rowCount=$tabelData.DataTable().data().count();0!==selected.length?0!==rowCount?Swal.fire({icon:"question",title:"Konfirmasi",html:langText.removeTitle+"<br>"+langText.removeText,showCancelButton:!0,confirmButtonColor:"#d33"}).then((result=>{if(result.isConfirmed){isGenerating=!0,Beranda.progressBar.css("width","0%").text("0 %"),Beranda.progressModal.modal("show");let progress=0;const interval=setInterval((()=>{progress<90&&(progress+=1,Beranda.progressBar.css("width",`${progress}%`).text(`${progress} %`))}),200);let ids=selected.map((function(){return $(this).val()})).get();$.post(Lokasi.urlHapus,{ids:ids}).done((function(response){clearInterval(interval),Beranda.progressBar.css("width","100%").text("100 %"),setTimeout((()=>{Beranda.progressModal.modal("hide"),Swal.fire("Sukses",response.messages,"success").then((()=>{let table=$tabelData.DataTable();$("#checkAll").prop("checked",!1),table.ajax.reload((function(){let info=table.page.info();info.recordsDisplay>0&&info.end-info.start==0&&info.page>0&&table.page(info.page-1).draw(!1)}),!1)}))}),500)})).fail((function(xhr){clearInterval(interval),Beranda.progressModal.modal("hide");let msg=xhr.responseJSON?.messages||"Terjadi kesalahan saat proses.";Swal.fire("Gagal",msg,"error")}))}})):Swal.fire("Informasi","Data tabel kosong, proses dihentikan.","info"):Swal.fire("Peringatan","Silakan pilih minimal satu data untuk dihapus.","warning")}$(document).ready((function(){$statContainer.HelperStatBox({endpoint:"/admin/statistik/user-login"})})),TabelHelper.tabelDinamis($tabelData,Lokasi.urlTabel,[{text:"Hapus",action:()=>{onclick=hapus()}},{text:"Reset",attr:{id:"btn-reset"}},{extend:"excelHtml5",text:"Excel",exportOptions:{columns:":visible:not(:eq(1))"}}],[{targets:0,width:"5%"},{targets:[1,3,4,7,8],className:"dt-body-center"},{targets:"_all",className:"dt-head-center"},{targets:[1,3,6,7],orderable:!1},{targets:[0,1,3,7,9,10,11,12],searchable:!1},{targets:[3],render:TabelHelper.tabelTanggalWaktu}],[[0,"desc"]],{initComplete:function(){let api=this.api(),filterContainer=$("#tabel-data_filter"),extraFilters=$('<div class="ml-2 d-inline-block"></div>');api.columns([2,8]).every((function(){let column=this,headerText=$(column.header()).text().trim(),select=$('<select class="form-control form-control-sm d-inline-block w-auto mr-1"><option value="">Semua '+headerText+"</option></select>").appendTo(extraFilters).on("change",(function(){let val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val?"^"+val+"$":"",!0,!1).draw()}));column.data().unique().sort().each((function(d){select.append('<option value="'+d+'">'+d+"</option>")}))})),filterContainer.append(extraFilters),api.on("xhr.dt",(function(){$statContainer.HelperStatBox("refresh")}))}}),$("#checkAll").on("click",(function(){$(".checkItem").prop("checked",this.checked)})),$("#btn-reset").on("click",(function(){0!==$tabelData.DataTable().data().count()?Beranda.aksiAjax("#btn-reset","Konfirmasi",langText.removeReset+"<br>"+langText.removeText,"question",Lokasi.urlReset,{useLoading:!0,onSuccess:()=>{$tabelData.DataTable().ajax.reload(null,!1)}}):Swal.fire("Informasi","Data tabel kosong, proses dihentikan.","info")}));